{% extends 'base.html' %}
{% load static %}
{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/my.tmp.css' %}">

{% endblock %}
{% block content %}

<section class="mt-8">
    <!-- contianer -->
    <div class="container">
        <div class="row">
            <!-- col -->
            <div
                class="bg-light d-lg-flex justify-content-between align-items-center py-6 py-lg-3 px-8 rounded-3 text-center text-lg-start">
                <!-- img -->
                <div class="d-lg-flex align-items-center">
                    <img src="../assets/images/about/about-icons-1.svg" alt="" class="img-fluid">
                    <!-- text -->

                    <div class="ms-lg-4">
                        <h1 class="fs-2 mb-1">测序数据管理</h1>
                        <span>若您上传数据的‘测序公司’或‘区域’不在列表中，请登录后台添加相应信息后再试！</span>
                    </div>
                </div>
                <div class="mt-3 mt-lg-0">
                    <!-- btn -->
                    <a href="{% url 'data:update' %}" class="btn btn-dark">更新数据库</a>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

<section class="mt-6 ">
    <div class="container border">
        <!-- form of input -->
        <div class="row">
            <div class="col-12">
                <!-- cta -->
                <div class="mb-8">
                    <!-- heading -->
                    <h3 class="mb-0">添加新数据</h3>
                </div>
            </div>

            <div class="col-12">
                <form id="formAdd">
                    {% for field in form %}
                    <div class="mb-3 mt-6">
                        <label class="form-label">{{ field.label }}</label>
                        {{ field }}
                        <span class="error-msg" style="color:red; position: absolute;">{{ field.errors.0 }}</span>
                    </div>
                    {% endfor %}

                    <div class="col-xs-7 mb-3 mt-6">
                        <button id="btnAdd" type="button" class="btn btn-primary btn-lg">添加新数据</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<section class="mt-6">
    <div class="container">
        <div class="row">
            <!-- Table -->
            <table class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">数据路径</th>
                        <th scope="col">区域</th>
                        <th scope="col">公司</th>
                        <th scope="col">时间</th>
                        <th scope="col">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for obj in queryset %}
                    <tr>
                        <th scope="row">{{ obj.id }}</th>
                        <td>{{ obj.data_path }}</td>
                        <td>{{ obj.area }}</td>
                        <td>{{ obj.company }}</td>
                        <td>{{ obj.ctime }}</td>
                        <td>
                            <a class="btn btn-secondary btn-sm" , href="{% url 'seqData:data_edit' nid=obj.id %}">编辑</a>
                            <a class="btn btn-danger btn-sm" , href="{% url 'seqData:data_delete' nid=obj.id %}">删除</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <nav aria-label="Page navigation example">
            <ul class='pagination'>
                {{ page_string }}
            </ul>
        </nav>


    </div>
</section>

{% endblock %}

{% block javascript %}
<script src="{% static 'js/jquery.js' %}"></script>
<script type="text/javascript">
    $(function () {
        bindFormAddEvent();
    });
    function bindFormAddEvent() {
        $('#btnAdd').click(function () {
            $("#error-msg").text(''); // 清空错误信息
            var formData = $('#formAdd').serialize();
            $.ajax({
                url: '/SeqData/add/',
                type: 'POST',
                dataType: 'json',
                data: formData,
                success: function (res) {
                    if (res.status) {
                        alert('添加成功');
                        // 用JS实现页面的刷新
                        // location.reload();
                    } else {
                        $.each(res.error, function (name, data) {
                            // console.log(name, data);
                            $("#id_" + name).next().text(data[0]);
                        })
                    }
                }
            });
        });
    }
</script>
{% endblock %}